
### **Winograd 卷积 CPU 版本优化报告**

**作者:** 3240103849
**日期:** 2025-08-28

#### **1. 摘要**
本次任务针对 Winograd 卷积在 128 核鲲鹏 920 CPU 平台上的性能进行优化。遵循“性能剖析-瓶颈定位-针对性优化”的方法，将一个比直接卷积慢 4.3 倍的基准实现，通过**循环分块 (Loop Blocking)** 和 **ARM Neon SIMD 向量化**两阶段优化，最终取得了相较于初始版本约 **27 倍**的性能提升，以及相较于直接卷积基准 **6.09 倍**的总体加速比。

---

#### **2. 优化历程与性能分析**

**2.1 基准性能评估**
* **初始状态:** 基准 Winograd 实现性能低下，运行耗时 86,914 ms，性能比直接卷积慢 4.3 倍。
* **结论:** 存在严重的实现层面瓶颈，优化空间巨大。

**2.2 性能瓶颈分析**
* **分析工具:** 在尝试 `gprof` 和 `VTune` 后，最终确定使用与 ARM 架构兼容的 Linux `perf` 工具进行性能剖析。
* **瓶颈定位:** `perf` 分析报告明确指出，`sgemm_parallel` 函数（一个朴素的三重循环矩阵乘法）是绝对的性能瓶颈，消耗了 **88.94%** 的总 CPU 时间。

**2.3 第一阶段：内存访问优化 (Loop Blocking)**
* **优化策略:** 借鉴 Lab 3 中的 Tiling 经验，对 `sgemm_parallel` 函数采用循环分块策略，设定块大小为 32x32，以提升 CPU 缓存数据复用率，降低访存延迟。
* **优化结果:** 仅此项优化，带来 **~7.2 倍**的性能提升，使 Winograd 性能首次超越直接卷积。

**2.4 第二阶段：计算核心优化 (Neon SIMD)**
* **优化策略:** 在解决内存瓶颈后，借鉴 Lab 2 中的 SIMD 经验，使用 ARM Neon 指令集对分块矩阵乘法的最内层循环进行向量化改造。通过 `vfmaq_f32` 等指令，实现单指令处理 4 个浮点数的并行计算。
* **优化结果:** 在分块优化的基础上，额外获得了 **~3.7 倍**的计算性能提升。

---

#### **3. 最终性能总结**

| 优化阶段 | 执行时间 (ms) | 阶段性加速比 (相对上一步) | 累计加速比 (相对初始版) |
| :--- | :--- | :--- | :--- |
| **初始 Winograd 代码** | 86,914 | - | 1.0x |
| **+ 循环分块** | 12,050 | 7.2x | 7.2x |
| **+ Neon SIMD** | **3,229** | **3.7x** | **26.9x** |

**结论:** 经过两阶段的针对性优化，最终代码性能相较初始版本提升了约 **27 倍**，相较于直接卷积基准，取得了 **6.09 倍**的总体加速比，优化任务成功完成。